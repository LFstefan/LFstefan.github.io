<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|comic sans:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="染心" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="一只奋进的小菜鸟">
<meta property="og:type" content="website">
<meta property="og:title" content="染心">
<meta property="og:url" content="https://lfstefan.github.io/page/4/index.html">
<meta property="og:site_name" content="染心">
<meta property="og:description" content="一只奋进的小菜鸟">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="染心">
<meta name="twitter:description" content="一只奋进的小菜鸟">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://lfstefan.github.io/page/4/"/>





  <title>染心</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>
    <a href="https://github.com/LFstefan"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/567c3a48d796e2fc06ea80409cc9dd82bf714434/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png"></a>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">染心</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Coding Everyday</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://lfstefan.github.io/2019/10/09/SSH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘飞">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="染心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/09/SSH/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-09T21:44:53+08:00">
                2019-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/10/09/SSH/" class="leancloud_visitors" data-flag-title="">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>什么是SSH？安全协议，远程认证协议，采用公钥密钥<br>SSH 为<br>    Secure Shell 的缩写，由 IETF 的网络小组（Network Working Group）所制定；SSH 为建立在应用层基础上的安全协议。SSH 是目前较可靠，专为<br>    远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。SSH最初是UNIX系统上的一个程序，后来又迅速扩展到其他操作平台。SSH在正确使用时可弥补网络中的漏洞。SSH客户端适用于多种平台。几乎所有UNIX平台—包括<br>    HP-UX、<br>    Linux、<br>    AIX、<br>    Solaris、<br>    Digital<br>    UNIX、<br>    Irix，以及其他平台，都可运行SSH。</p>
<p>ssh有什么用？<br>传统的网络服务程序，如：<br>    ftp、pop和<br>    telnet在本质上都是不安全的，因为它们在网络上用<br>    明文传送口令和数据，别有用心的人非常容易就可以截获这些口令和数据。而且，这些服务程序的<br>    安全验证方式也是有其弱点的， 就是很容易受到“中间人”（man-in-the-middle）这种方式的攻击。所谓“中间人”的攻击方式， 就是“中间人”冒充真正的<br>    服务器接收你传给服务器的数据，然后再冒充你把数据传给真正的服务器。服务器和你之间的数据传送被“中间人”一转手做了手脚之后，就会出现很严重的问题。通过使用SSH，你可以把所有传输的数据进行加密，这样”中间人”这种攻击方式就不可能实现了，而且也能够防止DNS欺骗和IP欺骗。使用SSH，还有一个额外的好处就是传输的数据是经过压缩的，所以可以加快传输的<br>    速度。SSH有很多功能，它既可以代替<br>    Telnet，又可以为<br>    FTP、<br>    PoP、甚至为<br>    PPP提供一个安全的”通道”</p>
<p>Telnet本质上是什么？<br>Ping ip本质上是什么？经历了什么？</p>
<p>第一种级别（基于口令的安全验证）<br>只要你知道自己帐号和口令，就可以登录到远程主机。所有传输的数据都会被加密，但是不能保证你正在连接的服务器就是你想连接的服务器。可能会有别的服务器在冒充真正的服务器，也就是受到“中间人”这种方式的攻击。<br>第二种级别（基于密匙的安全验证）<br>需要依靠密匙，也就是你必须为自己创建一对密匙，并把公用密匙放在需要访问的服务器上。如果你要连接到SSH服务器上，客户端软件就会向服务器发出请求，请求用你的密匙进行安全验证。服务器收到请求之后，先在该服务器上你的主目录下寻找你的公用密匙，然后把它和你发送过来的公用密匙进行比较。如果两个密匙一致，服务器就用公用密匙加密“质询”（challenge）并把它发送给客户端软件。客户端软件收到“质询”之后就可以用你的私人密匙解密再把它发送给服务器</p>
<p>SSH 主要由三部分组成：<br>传输层协议 [SSH-TRANS]<br>提供了服务器认证，保密性及完整性。此外它有时还提供压缩功能。 SSH-TRANS 通常运行在TCP/IP连接上，也可能用于其它可靠数据流上。 SSH-TRANS 提供了强力的加密技术、密码主机认证及完整性保护。该协议中的认证基于主机，并且该协议不执行用户认证。更高层的用户认证协议可以设计为在此协议之上。<br>用户认证协议 [SSH-USERAUTH]<br>用于向服务器提供客户端用户鉴别功能。它运行在传输层协议 SSH-TRANS 上面。当SSH-USERAUTH 开始后，它从低层协议那里接收会话标识符（从第一次密钥交换中的交换哈希H ）。会话标识符唯一标识此会话并且适用于标记以证明私钥的所有权。 SSH-USERAUTH 也需要知道低层协议是否提供保密性保护。<br>连接协议 [SSH-CONNECT]<br>将多个加密隧道分成逻辑通道。它运行在用户认证协议上。它提供了交互式登录话路、远程命令执行、转发 TCP/IP 连接和转发 X11 连接。</p>
<p>服务端是一个守护进程(daemon)，他在后台运行并响应来自客户端的连接请求。服务端一般是sshd进程，提供了对远程连接的处理，一般包括公共密钥认证、密钥交换、对称密钥加密和非安全连接。<br>客户端包含ssh程序以及像scp（远程拷贝）、slogin（远程登陆）、sftp（安全文件传输）等其他的应用程序。<br>他们的工作机制大致是本地的客户端发送一个连接请求到远程的服务端，服务端检查申请的包和IP地址再发送密钥给SSH的客户端，本地再将密钥发回给服务端，自此连接建立。</p>
<p>明文：需要秘密传送的消息。<br>密文：明文经过密码变换后的消息。<br>加密：由明文到密文的变换。<br>解密：从密文恢复出明文的过程。<br>破解：非法接收者试图从密文分析出明文的过程。<br>加密算法：对明文进行加密时采用的一组规则。<br>解密算法：对密文进行解密时采用的一组规则。<br>密钥：加密和解密时使用的一组密码信息。<br>对称加密：是采用单钥密码系统的加密方法，使用同一密钥对信息进行加密和解密的加密方法。<br>非对称加密：需要两个密钥：公共密钥和私有密钥，它们成对出现，公钥加密的数据有且只有私钥能解密，私钥加密的数据有且只有公钥解密，相对于“对称加密”，“非对称加密”加密方法加密和解密使用不同的密钥，所以叫“非对称加密”加密方法。<br>对称加密和非对称加密的区别：在于加密和解密是否使用的同一个密钥。</p>
<p>加密、身份认证、数字签名认证：<br>     加密：将数据资料加密，使得非法用户即便获取加密后的资料，也无法获取正确的资料内容，所以数据加密可以保证数据防止监听攻击；其重点在于数据的安全性。<br>    身份认证：判断某身份的真实性，确认身份后，系统才可以依不同的身份赋予不同的权限；其重点在于用户的真实性。<br>    数字签名认证：首先”数字签名”就是附加在数据单元上的一些数据，或是对数据单元所作的密码变换。这种数据或变换允许接收者判断数据的来源和数据的完整性，防止被伪造篡改。数字签名认证侧重于把保证数据的完整性，防止被伪造和篡改。</p>
<p>ssh详细过程<br>ssh的登录过程分为5个阶段<br>    1、版本号协商阶段<br>    2、密钥和算法协商阶段<br>    3、认证阶段<br>    4、会话请求阶段<br>    5、会话交互阶段<br>1、版本号协商阶段<br>    服务端打开端口22，等待客户连接。<br>    客户端向服务端发起TCP连接，连接建立后，服务端向客户端发送第一个报文，包括版本标志字符串，格式为“协议版本号 次协议版本号 软件版本号”。<br>    客户端收到报文后，解析协议版本号，如果服务端的协议版本号比自己的低，且客户端能支持服务端的低版本，就使用服务端的协议号，否则使用自己的协议版本号。<br>    客户端回复服务端一个报文，包含了客户端决定使用的协议版本号。<br>    服务端比较客户端发过来的版本号，决定是否能同客户端交互。<br>    如果协商成功，就进入密钥和算法协商阶段。否则服务端断开TCP连接。</p>
<p>2、密钥和算法协商阶段<br>    服务端和客户端分别发送算法协商报文给对方，报文中包含自己支持的公钥算法列表、加密算法列表、消息验证码算法列表、压缩算法列表等。<br>    服务端和客户端根据对方和自己支持的算法得出最终使用的算法。<br>    服务端和客户端利用DH交换算法、主机密钥对等参数，生成会话密钥和会话ID。<br>        c公 客户端公钥<br>        c密 客户端密钥<br>        s公 服务端公钥<br>        s密 服务端密钥<br>在版本号协商阶段完成后：<br>    服务端将 s公 发送给客户端。<br>    服务端生成会话ID ，设为 id ，发送给客户端。<br>    客户端生成会话密钥，设为 key ，并计算 res = id 异或 key。<br>    客户端将 res 用 s公 进行加密，将结果发送给服务端。<br>    服务端用 s密 进行解密，得到 res。<br>    服务器计算 res 异或 id，得到 key。<br>    至此服务端和客户端都知道了会话密钥和会话ID，以后的数据传输都使用会话密钥进行加密和解密。</p>
<p>3、认证阶段<br>基于账号和口令的验证方式：<br>    客户端使用密钥和算法协商阶段生成的会话密钥加密账号、认证方法、口令，将结果发送给服务器。<br>    服务端使用获得的会话密钥解密报文，得到账号和口令。<br>    服务端对这个账号和口令进行判断，如果失败，向客户端发送认证失败报文，其中包含了可以再次认证的方法列表。<br>    客户端从认证方法列表中选择一种方法进行再次认证。<br>    这个过程反复进行，直到认证成功或者认证次数达到上限，服务端关闭本次TCP连接。<br>基于公钥和私钥的验证方式：<br>    使用ssh-keygen程序生成公钥 id_dsa.pub 和私钥 id_dsa，一般是在客户端上生成，然后把 id_dsa.pub 通过某种方式发送给服务端。<br>    服务端放在将要远程登录过来的那个账号的目录的.ssh目录下面。<br>    客户端使用密钥和算法协商阶段生成的会话密钥加密账号、认证方法、id_dsa.pub，将结果发送给服务端。<br>    服务端使用会话密钥解密报文，得到账号、id_dsa.pub。    服务端在这个账号的目录的.ssh目录下找对应的公钥，如果没有找到，发送失败消息给客户端，如果找到，比较客户发送过来的这个公钥和找到的公钥，如果内容相同，服务端生成一个随机的字符串，简称“质询”，然后使用找到的公钥加密这个质询，然后使用会话密钥再次加密。<br>    服务端把这个双重加密的数据发送给客户端。<br>    客户端使用会话密钥解密报文，然后使用id_dsa再次解密数据，得到质询。<br>    客户端使用会话密钥加密质询，发送给服务端。<br>    服务端使用会话密钥解密报文，得到质询，判断是不是自己生成的那个质询，如果不相同，发送失败消息给客户端，如果相同，认证通过。</p>
<p>RSA加密算法是一种非对称加密算法。在公开密钥加密和电子商业中RSA被广泛使用。RSA是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。当时他们三人都在麻省理工学院工作。RSA就是他们三人姓氏开头字母拼在一起组成的。<br>1973年，在英国政府通讯总部工作的数学家克利福德·柯克斯（Clifford Cocks）在一个内部文件中提出了一个相同的算法，但他的发现被列入机密，一直到1997年才被发表。<br>对极大整数做因数分解的难度决定了RSA算法的可靠性。换言之，对一极大整数做因数分解愈困难，RSA算法愈可靠。假如有人找到一种快速因数分解的算法的话，那么用RSA加密的信息的可靠性就肯定会极度下降。但找到这样的算法的可能性是非常小的。今天只有短的RSA钥匙才可能被强力方式解破。到目前为止，世界上还没有任何可靠的攻击RSA算法的方式。只要其钥匙的长度足够长，用RSA加密的信息实际上是不能被解破的。<br>DSA是基于整数<br>    有限域<br>    离散对数难题的，其安全性与<br>    RSA相比差不多。DSA的一个重要特点是两个素数公开，这样，当使用别人的p和q时，即使不知道<br>    私钥，你也能确认它们是否是随机产生的，还是作了手脚。<br>    RSA算法却做不到。<br>椭圆加密算法（<br>    ECC）是一种<br>    公钥加密体制，最初由Koblitz和Miller两人于1985年提出，其数学基础是利用椭圆曲线上的<br>    有理点构成Abel加法群上椭圆<br>    离散对数的计算困难性。公钥密码体制根据其所依据的难题一般分为三类：大素数分解问题类、<br>    离散对数问题类、椭圆曲线类。有时也把椭圆曲线类归为离散对数类。</p>
<p>ECDSA算法是ECC+DSA的结合体</p>
<p>怎么查看ssh当前使用的是哪一种算法，或者查看支持那些算法？</p>
<p>构建 ssh 密钥对<br>使用 ssh-keygen -t +算法 ，现在大多数都使用rsa或者dsa算法。 $ ssh-keygen -t rsa</p>
<p>SHA512</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://lfstefan.github.io/2019/10/09/Excel导入导出/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘飞">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="染心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/09/Excel导入导出/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-09T21:29:27+08:00">
                2019-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/10/09/Excel导入导出/" class="leancloud_visitors" data-flag-title="">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>6. excel导入导出 
    如果要将查询结果导出到Excel，只需将页面的Context-Type修改一下就可以了：
       header( &quot;Content-Type: application/vnd.ms-excel&quot;&gt;
    如果希望能够提供那个打开/保存的对话框，Content-Disposition参数，Content-Disposition参数本来是为了在客户端另存文件时提供一个建议的文件名，但是考虑到安全的原因，就从规范中去掉了这个参数
    Content-Disposition参数：
    attachment --- 作为附件下载   
    inline --- 在线打开
    具体使用如：header(&quot;Content-Disposition: inline; filename=文件名.mp3&quot;);
        Header(&quot;Content-Disposition：attachment;filename=test.xls&quot;);
</code></pre><p>写：<a href="https://www.callicoder.com/java-write-excel-file-apache-poi/" target="_blank" rel="external">https://www.callicoder.com/java-write-excel-file-apache-poi/</a><br>读：<a href="https://www.callicoder.com/java-read-excel-file-apache-poi/" target="_blank" rel="external">https://www.callicoder.com/java-read-excel-file-apache-poi/</a></p>
<p>输出仅支持基本类型，对象类型/数组类型需要设置对应的格式化行为才能输出</p>
<p>单表导出到一个sheet中，或者按条数导出到多个sheet中</p>
<p>多表导出到多个sheet中，或者多个Excel文件中</p>
<p>java数据类型—Excel数据类型怎么对应</p>
<p>自定义导出字段的顺序，样式，字体，格式等</p>
<p>读取时的各项校验，读取的目的不同，解决方案不同，读取直接插库，还是需要经过处理工厂</p>
<p>如何做到边读边处理 ，边处理边写</p>
<p>多线程同时写入多个sheet或者多个excel</p>
<p>官网给出的数据量限制解决方案<br><a href="http://poi.apache.org/components/spreadsheet/limitations.html" target="_blank" rel="external">http://poi.apache.org/components/spreadsheet/limitations.html</a></p>
<p>.xsl格式：HSSFWorkbook —底层实现原理和机构是什么<br>.xslx格式：XSSFWorkbook—底层实现原理和机构是什么—导致OOM的原因</p>
<p>最新版支持保持指定数据行在内存中，其余刷到磁盘中<br><a href="https://dzone.com/articles/resolve-outofmemoryerror-with-excelexport-export-e" target="_blank" rel="external">https://dzone.com/articles/resolve-outofmemoryerror-with-excelexport-export-e</a></p>
<p>流式读取excel：<a href="https://github.com/monitorjbl/excel-streaming-reader" target="_blank" rel="external">https://github.com/monitorjbl/excel-streaming-reader</a></p>
<p>基本四要素：workbook工作簿，sheet做工表页，row数据行，cell数据列</p>
<p>xssfWorkbook不关闭会怎么样？</p>
<p>SXSSFWorkbook只支持.xlsx格式，不支持.xls格式的Excel文件</p>
<ol>
<li>启用共享字符串时，文档中的所有唯一字符串都必须保存在内存中。根据文档内容，这可能使用比禁用共享字符串更多的资源。</li>
<li>在决定是否启用共享字符串之前，仔细查看内存预算和兼容性需求</li>
</ol>
<p>springboot读取resources下的文件方式?—待做spring-boot-file(文件读取，上传，下载，量的控制)<br>    classpath路径指的到底是什么位置<br>        ResourceUtils.getFile(“classpath:liufein.excel.file\liufein.xlsx”)—读取resources下的文件格式为这个样子<br>    • maven在pom文件中build下配置resource标签<br>        <resources><br>        <resource><br>        <directory>src/main/java</directory><br>        <includes><br>        <include><strong>/<em>.</em></strong></include><br>        </includes><br>        </resource><br>        <resource><br>        <directory>src/main/resources</directory><br>        <includes><br>        <include>/<em>.</em></include><br>        </includes><br>        </resource><br>        </resources></p>
<p>springboot图片处理？对接cdn，静态资源存放—spring-boot-image</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://lfstefan.github.io/2019/10/09/全局异常处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘飞">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="染心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/09/全局异常处理/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-09T21:27:23+08:00">
                2019-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/10/09/全局异常处理/" class="leancloud_visitors" data-flag-title="">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>2. 全局异常的处理
    a. springboot处理异常：https://www.logicbig.com/tutorials/spring-framework/spring-boot/implementing-error-controller.html
    b. 使用枚举类实现全局业务错误码和描述的定义
        i. 但是枚举类内部元素不支持纯数字，可以是字母加数字，例如GX0001
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://lfstefan.github.io/2019/10/09/接口API参数校验/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘飞">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="染心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/09/接口API参数校验/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-09T21:26:29+08:00">
                2019-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/10/09/接口API参数校验/" class="leancloud_visitors" data-flag-title="">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> 接口API中的每个参数字段均需要做校验，涉及</p>
<ul>
<li>如何处理所有的入参/出参</li>
<li>序列化方式选择</li>
<li>参数校验（格式，内容，null值）<ul>
<li>样例2：入参字段校验</li>
</ul>
<ol>
<li>Java 提供的validation注解校验（JSR提供的校验注解）       </li>
<li>spring提供的validation注解校验</li>
<li>hibernate提供的validation注解校验</li>
<li>@Validated和@Valid的区别是什么</li>
</ol>
</li>
<li>参数命名规则（下划线，驼峰）<ul>
<li>样例1：@JsonProperty，入参出参字段名序列化转换（下划线转驼峰）@JsonProperty(value = “real_name”) private String realName; </li>
</ul>
</li>
<li>序列化对象和实体类对应关系，特殊字符和转义字符的考虑<ul>
<li>样例3：json解析转义字符：设置属性不考虑转义字符<br>Feature.ALLOW_UNQUOTED_CONTROL_CHARS, true)</li>
</ul>
</li>
</ul>
<pre><code>6. Json 
    ○ 序列化字段忽略
    @JsonIgnore
    ○ 自定义字段名
        @JsonProperty(value=&quot;main_config&quot;)
    ○ 格式化日期
    @JsonFormat(shape=JsonFormat.Shape.STRING,pattern=&quot;yyyy-MM-dd&quot;)
    ○ lombok中子类继承导致的属性相关问题
    /*@ToString(callSuper=true)
    @EqualsAndHashCode(callSuper=true)*/
</code></pre><p>jackson文档过一遍<br>@JsonProperty的elements如下所示:<br>value: 定义逻辑属性的名称<br>access: 更改序列化和反序列化中逻辑属性的可见性<br>defaultValue: 用于记录预期的默认值<br>index: 定义与object指定的其他属性相关的属性的数字索引<br>required: 定义在反序列化期间是否需要属性的值</p>
<p>DecimalMin<br>Supported types are:<br>    • BigDecimal<br>    • BigInteger<br>    • CharSequence<br>    • byte, short, int, long, and their respective wrappers<br>Note that double and float are not supported due to rounding errors (some providers might provide some approximative support).<br>null elements are considered valid.</p>
<p>继承，内部类的字段校验</p>
<h2 id="spring中-Validated实现原理"><a href="#spring中-Validated实现原理" class="headerlink" title="spring中@Validated实现原理"></a>spring中@Validated实现原理</h2><pre><code>• JSR-303规范
• 使用Bean Validation验证对象的属性
    ○ 2.使用Bean Validation constraint注解定义属性
    ○ // 3.获取目标对象实例 Person person = getTargetBeanInstance(); 
    ○ // 4.获取bean validation验证类(单例即可) ValidatorFactory validatorFactory = Validation.buildDefaultValidatorFactory(); Validator validator = validatorFactory.getValidator();
    ○  // 5.验证对象属性 Set&lt;ConstraintViolation&lt;Person&gt;&gt; set = validator.validate(person); /
    ○ / 6.输出验证结果 for (ConstraintViolation&lt;Person&gt; constraintViolation : set) { System.out.println(constraintViolation.getMessage()); }
• 使用Bean Validation验证方法入参
    ○ public interface TestService {

    ○     // 1.使用Bean Validation constraint注解定义方法入参
Person create(@NotNull @Valid Person person, @NotBlank String channel);
</code></pre><p>}<br>public static void main(String[] args) throws Exception {<br>        ○<br>    // 2.获取到目标类的实例<br>    TestService testService = getTargetService();<br>        ○<br>    // 3.获取目标类需要验证的方法<br>    Method method = testService.getClass().getMethod(“create”, Person.class, String.class);<br>        ○<br>    // 4.获取目标方法的入参<br>    Object[] parameterValues = { person, channel };<br>        ○<br>    // 5.获取bean validation验证类(单例即可)<br>    ValidatorFactory validatorFactory = Validation.buildDefaultValidatorFactory();<br>    Validator validator = validatorFactory.getValidator();</p>
<pre><code>    ○     // 6.验证目标方法的入参
Set&lt;ConstraintViolation&lt;TestService&gt;&gt; set = validator.forExecutables().validateParameters(testService, method, parameterValues, new Class&lt;?&gt;[0]);

    ○     // 7.输出验证结果
for (ConstraintViolation&lt;TestService&gt; constraintViolation : set) {
    System.out.println(constraintViolation);
}
</code></pre><p>}<br>    • 使用Bean Validation验证方法返回值<br>        ○ public interface TestService {</p>
<pre><code>    ○     // 1.使用Bean Validation constraint注解定义方法返回值
@NotNull @Valid Person create();
</code></pre><p>}<br>public static void main(String[] args) throws Exception {</p>
<pre><code>    ○ // 2.获取到目标类的实例
TestService testService = getTargetService();
/
    ○ / 3.获取目标类需要验证的方法
Method method = testService.getClass().getMethod(&quot;create&quot;);
/
    ○ / 4.获取目标方法的返回值
Object returnValue = method.invoke(object);
/
    ○ / 5.获取bean validation验证类(单例即可)
ValidatorFactory validatorFactory = Validation.buildDefaultValidatorFactory();
Validator validator = validatorFactory.getValidator();
/
    ○ / 6.验证目标方法的返回值
Set&lt;ConstraintViolation&lt;TestService&gt;&gt; set = validator.forExecutables().validateReturnValue(testService, method, returnValue, new Class&lt;?&gt;[0]);
/
    ○ / 7.输出验证结果
for (ConstraintViolation&lt;TestService&gt; constraintViolation : set) {
    System.out.println(constraintViolation);
}
</code></pre><p>}</p>
<pre><code>spring-mvc的参数解析器（很值得研究），上面的两个参数解析器主要解析使用以下几个注解修饰的参数：
    • @RequestBody
    • @ResponseBody
    • @ModelAttribute


MethodValidationPostProcessor实现原理
    • 拦截所有使用@Validated修饰的类（可以从父类继承注解），如果方法入参或者返回值被Bean Validation constraint注解修饰，则会做数据校验

嵌套的对象为什么不做验证？


参数校验能否有一个不通过就返回，后续属性就不要再验证了？
开启failFast，如下：
Configuration&lt;?&gt; configure = Validation.byDefaultProvider().configure();
</code></pre><p>configure.addProperty(HibernateValidatorConfiguration.FAIL_FAST, “true”);<br>Validator validator = configure.buildValidatorFactory().getValidator();</p>
<pre><code>○ @ScriptAssert(lang = &quot;javascript&quot;, script = &quot;_this.conditionNull == null || (_this.conditionNull != null &amp;&amp; _this.conditionNotNull !=null)&quot;, message = &quot;条件判断:如果conditionNull不为空时,则conditionNotNull也不能为空&quot;)
</code></pre><p>入参校验，可空，非空时做校验</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://lfstefan.github.io/2019/10/09/快捷键-运维命令大全/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘飞">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="染心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/09/快捷键-运维命令大全/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-09T21:24:49+08:00">
                2019-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/10/09/快捷键-运维命令大全/" class="leancloud_visitors" data-flag-title="">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>- idea快捷键
</code></pre><p>svn设置文件不参与更新—如何恢复（拉取最新后revert）<br>Svn revert filename：恢复本地文件到服务器上最近最新的版本<br>Svn log -l 3：查看最近最新的三次提交记录历史<br>Svn log -v -l 3 ：查看最近最新的三次提交记录历史（包含详细改动文件）<br>Svn log | less ：使用shell命令less和管道 | 分页查看提交历史<br>svn log -r {2019-08-05}:{2019-08-06} ：查看时间段内的提交历史纪录</p>
<p>idea快捷键：忽略文件ingore—-ctrl+alt+I<br>    sout：System.out.println的快捷键<br>    psvm：main主函数快捷键<br>    fori：for循环快捷键<br>显示文件提交历史：shift+h<br>idea全局替换—ctrl+R（自定义）<br>自动try—catch或者其他包围代码快捷键—ctrl+alt+t</p>
<pre><code>- 日常工具/插件
</code></pre><p>org.apache.commons提供了大量的工具类使用提高效率<br>Cloud toolkit 阿里idea插件—部署应用神器，terminal充当shell直连服务器<br>mysql8.0的问题</p>
<pre><code>1. 应用重启无法连接到数据库服务问题：allowPublicKeyRetrieval=true修改连接参数
重置密码 alter user ‘root’@’localhost’ identified by ‘123456’;
重启mysql，重启服务

- 日常运维操作
    ○ Mysql
        § window7下 cmd命令行 Mysql导出表结构 + 表数据 
        § 查看库，表，列：SHOW [FULL] {COLUMNS | FIELDS} {FROM | IN} tbl_name [{FROM | IN} db_name] [LIKE &apos;pattern&apos; | WHERE expr]
        § 以一定的编码格式和排序方式创建/修改/查看数据库
        drop database if exists mini_main;
        create database mini_main default charset utf8mb4 collate utf8mb4_unicode_ci;
        alter database mini_shop_4748160 character set utf8mb4 collate utf8mb4_unicode_ci;
        select * from SCHEMATA where SCHEMA_NAME=&apos;mini_main&apos;\G
        § mysqldump -uvpu_user -p mini_shop_4748160 &gt; mini_shop_4748160.sql
        导出整个库，参数-d只导出表结构
        § scp mini_shop_4748160.sql administrator@192.168.1.240:/d:/


    ○ Svn
        Svn checkout：拉取代码
        Svn update：更新代码
        Svn status：查看本地修改了那些地方
    ○ Redis
        客户端连接：redis-cli -h 1270.0.1 -p 6379
        显示所有key值：keys *
        清空所有key值：flushall
        查看过期时间：ttl key
        设置过期时间：expire key 3000（单位秒）
        查看当前redis有没有设置密码：
        127.0.0.1:6379&gt; config get requirepass
        1) &quot;requirepass&quot;
        2) &quot;&quot;
        （3）为以上显示说明没有密码，那么现在来设置密码：
        127.0.0.1:6379&gt; config set requirepass abcdefg

    ○ Linux
        § 端口开放---查看，开放
            firewall-cmd --zone=public --add-port=3306/tcp --permanent（永久开放，无需重启，centos7以后使用）
            sudo /sbin/iptables -A INPUT -p tcp --dport 6379 -j ACCEPT
        § ps -ef|grep redis
        § egrep pattern fliename,...：文件内查找指定字符
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="刘飞" />
          <p class="site-author-name" itemprop="name">刘飞</p>
           
              <p class="site-description motion-element" itemprop="description">一只奋进的小菜鸟</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">159</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">137</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/LFstefan" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  Sat Apr 29 2017 08:00:00 GMT+0800 (China Standard Time) - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘飞</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  
    

    
  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      $('#local-search-input').focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("4jo3lh32lhNprUWelt3fCUrM-gzGzoHsz", "cTko66LfK5xF0OrYbFlACBB7");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

</body>
</html>
